<!DOCTYPE html>
<html lang="en" dir="ltr">
  <head>
    <meta charset="utf-8">
    <style media="screen">
      body {
        font-family: monospace;
        text-align: center;
      }

      h1 {
        font-size: 10vw;
        font-weight: bold;
      }

      textarea {
        margin: 0 auto 2em;
        width: 80%;
        max-width: 1024px;
        height: 40vh;
        display: block;
        font-size: 2em;
        padding: 0.5em;
      }

      button {
        font-family: monospace;
        font-size: 4em;
        width: 80%;
        max-width: 1024px;
      }
    </style>
    <title>Remote clipboard</title>
  </head>
  <body>
    <div id="pasted"><textarea id="pasteTxt"></textarea></div>
    <button type="button" id="pasteBtn" onclick="callFn()">Paste</button>
    <div id="pasted"></div>

    <script type="text/javascript" src="api.js"></script>
    <script type="text/javascript">
      function handleImage(blob) {
          var reader = new FileReader();
          reader.onload = function(event) {
            pasted.innerHTML = `<img src="${event.target.result}"/>`
          };
          reader.readAsDataURL(blob);
      }

      function handleText(text) {
        makePaste(text).catch(console.error)
      }

      pasteBtn.onclick = () => handleText(pasteTxt.value);

      document.onpaste = function (event) {
        const { items } = (event.clipboardData  || event.originalEvent.clipboardData);
        var blob = null;
        for (var i = 0; i < items.length; i++) {
          const item = items[i]
          if (item.type.indexOf('image') === 0) {
            handleImage(item.getAsFile())
          } else if (item.type === 'text/plain') {
            item.getAsString(handleText)
          }
        }
      }
    </script>
  </body>
</html>
