<!DOCTYPE html>
<html lang="en" dir="ltr">
  <head>
    <meta charset="utf-8">
    <style media="screen">
      body {
        font-family: monospace;
        text-align: center;
      }

      h1 {
        font-size: 10vw;
      }
    </style>
    <title>Remote clipboard</title>
  </head>
  <body>
    <h1>Paste</h1>
    <button type="button" name="button" onclick="callFn()">Try fn</button>
    <div id="pasted"></div>

    <script type="text/javascript">
      function handleImage(blob) {
          var reader = new FileReader();
          reader.onload = function(event) {
            pasted.innerHTML = `<img src="${event.target.result}"/>`
          };
          reader.readAsDataURL(blob);
      }

      function handleText(text) {
        pasted.innerHTML = `<code>${text}</code>`
      }

      document.onpaste = function (event) {
        const { items } = (event.clipboardData  || event.originalEvent.clipboardData);
        var blob = null;
        for (var i = 0; i < items.length; i++) {
          const item = items[i]
          console.log('item', item);
          if (item.type.indexOf('image') === 0) {
            handleImage(item.getAsFile())
          } else if (item.type === 'text/plain') {
            item.getAsString(handleText)
          }
        }
      }

      function callFn() {
        fetch('/.netlify/functions/paste')
          .then(r => r.json())
          .then(j => {
            pasted.innerHTML = `<code>${j}</code>`
          })
          .catch(console.error)
      }
    </script>
  </body>
</html>
